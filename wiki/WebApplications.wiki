#summary Impala Web Applications

Impala has a lot of features designed to make using and working with web applications as powerful and seamless as possible.
Impala provides flexible deployment options, and supports a large range of scenarios in enabling modular application development.

== Web deployment ==

Impala web applications can be launched in the Eclipse in an embedded Jetty Server. This is powerful, because it means that 
you can do all your web application development without having to run any build scripts. However, war based deployment is also supported.
For more information, see the [GettingStarted tutorial].

== Application development ==

Let's consider some of the *requirements* that Impala addresses:

  * *modular web applications*: we want the advantages of modularity to be available for the web tier of our applications just as with any other tier.
  We want to have fine-grained control over what portions of our web applications will be deployed. This is not necessarily straightforward.
  For example, if we use the traditional approach to Spring web application deployment, then servlets, servlet mappings, filters and Spring 
  application context locations are contained in _WEB-INF/web.xml_, which is only loaded up once at web application startup time, and cannot 
  easily be reloaded without restarting the entire web application.
  * *dynamic reloading support for other frameworks*: if we are developing our web tier using a framework which Impala doesn't support, then integration using the 
  traditional Spring mechanism is possible, because Impala will still publish an `ApplicationContext` under the standard key defined in 
  Spring's `WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE`. However, some of the benefit is lost, because if the full web application 
  needs to reload each time one of the web application classes changes, development is much slower than it otherwise would have been.
  
== Impala's approach ==

1) Impala allows you to arrange your web tier modules in a hierarchy. Just as you have a root module for the application as a whole, 
you also have a root module for the web tier, know as the _web root module_. The _web root module_ contains the servlet context resources,
that is, the resources which will be found below the context path in a deployed application, such as styles, images, jsp files, etc.

2) Impala provides web application modularity by adopting a servlet per module approach. Each web tier module is backed by it's own servlet.
Impala also allows you to back a particular module using a javax.http.Filter, rather than a servlet.

3) Impala also provides mechanisms which allows *reduced dependency on _WEB-INF/web.xml_*. For example, the full _web.xml_ for the 
[SamplesWebframework web frameworks sample] is shown below:

{{{
<web-app>
	
	<display-name>Impala web frameworks example</display-name>

	<description>An application which demonstrates tight integration of Struts, Tapestry5 and Wicket with Impala</description>
	
	<listener>
		<listener-class>org.impalaframework.web.loader.ImpalaContextLoaderListener</listener-class>
	</listener>
	
	<filter>
        <filter-name>filter</filter-name>
        <filter-class>org.impalaframework.web.integration.ModuleProxyFilter</filter-class>
        <init-param>
                <param-name>modulePrefix</param-name>
                <param-value>webframeworks-</param-value>
        </init-param>
    </filter>
    <filter-mapping>
        <filter-name>filter</filter-name>
        <url-pattern>/*</url-pattern>
    </filter-mapping>
	
    <servlet>
        <servlet-name>redirector</servlet-name>
        <servlet-class>org.impalaframework.web.integration.ModuleProxyServlet</servlet-class>
        <init-param>
                <param-name>modulePrefix</param-name>
                <param-value>webframeworks-</param-value>
        </init-param>
        <load-on-startup>1</load-on-startup>
    </servlet>
    
    <servlet-mapping>
        <servlet-name>redirector</servlet-name>
        <url-pattern>*.do</url-pattern>
    </servlet-mapping>
    
</web-app>
}}}

Note that apart from the `ContextLoaderListener`, there is just one filter definition and one servlet definition, for redirecting requests to 
the various modules. The actual configuration of the servlets and filters involved is performed within the modules. Impala provides mechanisms 
that allow the servlet and filter configuration to be provided, and the serlvet and filter life cycles to be observed as appropriate.
  
=== Impala Servlets ===

Impala provides a number of servlets which can be used in your application, depending your usage scenario.

===== org.impalaframework.web.servlet.ExternalModuleServlet =====

This is an extension of Spring MVC's `DispatcherSerlvet`. Use this servlet when
  * You are using Spring MVC as your web framework.
  * You are happy to declare the servlet in _web.xml_.
  
An example is shown below, taken from the [SamplesPetclinic Petclinic sample]:

{{{
<servlet>
	<servlet-name>petclinic-web</servlet-name>
    <servlet-class>org.impalaframework.web.servlet.ExternalModuleServlet</servlet-class>
	<load-on-startup>1</load-on-startup>
</servlet>

<servlet-mapping>
	<servlet-name>petclinic-web</servlet-name>
	<url-pattern>*.htm</url-pattern>
</servlet-mapping>
}}}

When `ExternalModuleServlet` starts up. It will 'attach' itself to the module corresponding with the servlet name, in this case _petclinic-web_.
The Spring application context it references will be updated each time the module reloads.

===== org.impalaframework.web.servlet.InternalModuleServlet =====

Like `ExternalModuleServlet`, `InternalModuleServlet` is an extension of Spring's `DispatcherServlet`. The key difference
is that it is configured within a module (not _web.xml_), and is hence internal to the module.

Use this Servlet if:
  * You are using Spring MVC as your web framework.
  * you want to avoid coupling your module with _web.xml_.

For example, if you want to design your application in such a way that the _web.xml_ does not need to have any knowledge of 
other web modules, you can use this technique. An example configuration is shown below, taken from module _example-servlet2_ in
the [SamplesExample example samples] application:

{{{
<bean class="org.impalaframework.web.integration.ServletFactoryBean">
	<property name = "servletName" value = "example-servlet2"/>
	<property name = "servletClass" value = "org.impalaframework.web.servlet.InternalModuleServlet"/>
</bean>	
}}}

  
