<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" 
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="
http://www.springframework.org/schema/beans 
http://www.springframework.org/schema/beans/spring-beans-2.0.xsd">
 
 <bean id="classLocationResolver" class="org.impalaframework.resolver.PropertyModuleLocationResolver"/>
	
 <bean id="rootPluginLoader" class="org.impalaframework.module.loader.ManualReloadingRootModuleLoader">
	<constructor-arg ref="classLocationResolver"/>
 </bean>	
	
 <bean id="applicationPluginLoader" class="org.impalaframework.module.loader.ApplicationModuleLoader">
	<constructor-arg ref="classLocationResolver"/>
 </bean>	
	
 <bean id="applicationBeansetPluginLoader" class="org.impalaframework.module.loader.BeansetApplicationModuleLoader">
	<constructor-arg ref="classLocationResolver"/>
 </bean>	
	
 <bean id="pluginLoaderRegistry" class="org.impalaframework.module.loader.ModuleLoaderRegistry">
	<property name = "pluginLoaders">
		<map>
			<entry key="root" value-ref="rootPluginLoader"/>
			<entry key="application" value-ref="applicationPluginLoader"/>
			<entry key="application_with_beansets" value-ref="applicationBeansetPluginLoader"/>
		</map>
	</property> 
 </bean>
	
 <bean id="applicationContextLoader" class="org.impalaframework.module.loader.DefaultApplicationContextLoader">
	<constructor-arg ref="pluginLoaderRegistry"/>	  
 </bean>
	
 <bean id="strictPluginModificationCalculator" class="org.impalaframework.module.modification.StrictModificationExtractor"/>
	
 <bean id="stickyPluginModificationCalculator" class="org.impalaframework.module.modification.StickyModificationExtractor"/>	
	
 <bean id="pluginModificationCalculatorRegistry" class="org.impalaframework.module.modification.ModificationExtractorRegistry">
	<property name = "pluginModificationCalculatorMap">
		<map>
			<entry key="strict" value-ref="strictPluginModificationCalculator"/>
			<entry key="sticky" value-ref="stickyPluginModificationCalculator"/>
		</map>
	</property> 
 </bean>	
	
 <bean id="loadTransitionProcessor" class="org.impalaframework.module.transition.LoadTransitionProcessor">
	<constructor-arg ref="applicationContextLoader"/>	 
 </bean>
	
 <bean id="unloadTransitionProcessor" class="org.impalaframework.module.transition.UnloadTransitionProcessor"/>	
	
 <bean id="addLocationsTransitionProcessor" class="org.impalaframework.module.transition.AddLocationsTransitionProcessor">
	<constructor-arg ref="pluginLoaderRegistry"/>	 
 </bean>	
	
 <bean id="transitionProcessorRegistry" class="org.impalaframework.module.transition.TransitionProcessorRegistry">
	<property name = "transitionProcessorMap">
		<map>
			<entry key="UNLOADED_TO_LOADED" value-ref="loadTransitionProcessor"/>
			<entry key="LOADED_TO_UNLOADED" value-ref="unloadTransitionProcessor"/>
			<entry key="CONTEXT_LOCATIONS_ADDED" value-ref="addLocationsTransitionProcessor"/>
		</map>
	</property> 
 </bean>
	
 <bean id="pluginStateManager" class="org.impalaframework.module.holder.DefaultModuleStateHolder">
	<property name="transitionProcessorRegistry" ref="transitionProcessorRegistry"/>	  
 </bean>

</beans>