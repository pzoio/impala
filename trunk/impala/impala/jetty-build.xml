<?xml version="1.0"?>
<project name="Impala Jetty Build">
	
	<import file = "${impala.home}/tomcat-build.xml"/>
	
	<property name = "web.lib.excludes" value = 
		"dist/*,**/*-sources.jar,jetty/*"/>
	
	<target 
		name="jetty:stage">
		<antcall target="web:libs">
			<!-- relative to webs-->
			<param name="web.modules.target" value="${web.staging.dir}/war/WEB-INF/modules"/>
		</antcall>
		
		<!-- copy slf4j files into WEB-INF lib -->
		<copy todir="${web.staging.dir}/war/WEB-INF/lib"
			flatten="true">
			<fileset dir="${repository.dir}" 
				includes="**/*slf4j*.jar"
				excludes="**/*sources*"/>
		</copy>
		
		<!-- remove commons logging -->
		<delete>
			<fileset dir="${web.staging.dir}/war/WEB-INF/lib" includes="**/commons-logging*"/>
		</delete>
		
		<!-- remove MX4J libraries - these need to be on main class path -->
		<delete>
			<fileset dir="${web.staging.dir}/war/WEB-INF/lib" includes="mx4j*"/>
		</delete>
		
	</target>
	
	<target 
		name="jetty:copy"
		depends="jetty:stage">
		
		<!-- copy the jetty jars in -->
		<copy todir="${web.staging.dir}/jetty"
			flatten="true">
			<fileset dir="${repository.dir}" 
				includes="jetty/*.jar 
						  main/commons-logging*.jar
						  **/mx4j*.jar"
				excludes="jetty/*sources*"/>
		</copy>
		
		<!-- copy the jetty launcher in -->
		<copy todir="${web.staging.dir}/jetty"
			flatten="true">
			<fileset dir="${repository.dir}" 
				includes="**/*startjetty*.jar"/>
		</copy>
		
		<copy todir="${web.staging.dir}"
			flatten="true">
			<fileset dir="${repository.dir}" 
				includes="**/launcher.jar"/>
		</copy>
		
		<copy todir="${web.staging.dir}/config">
			<fileset dir = "${external.web.config.dir}"/>
		</copy>
		
		<copy todir="${web.staging.dir}">
			<fileset dir = "${impala.home}/scripts" includes="*jetty*"/>
		</copy>
		
	</target>		
	
	<!--
	TODO add mechanism for setting build properties (preferably from classpath)
	java -jar launcher.jar org.mortbay.jetty.Server ==addjardir jetty		
	-->
	
</project>