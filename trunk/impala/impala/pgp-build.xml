<?xml version="1.0"?>
<project name="PGP build" xmlns:artifact="antlib:org.apache.commons.openpgp.ant">
    
	<property name="workspace.root" location=".." />
    <property name="impala.home" location="${workspace.root}/impala" />
    <property file="${workspace.root}/impala/pgp-build.properties" />
    <import file="${impala.home}/properties-build.xml" />
    <import file="${impala.home}/tasks-build.xml" />

	<taskdef resource="org/apache/commons/openpgp/ant/antlib.xml" uri="antlib:org.apache.commons.openpgp.ant">
		<classpath>
			<fileset dir="../impala-repository/pgp">
				<include name="commons-openpgp-1.0-SNAPSHOT.jar" />
			</fileset>
		</classpath>
	</taskdef>
	
    <target name="pgp:password" unless="pgp.password">
        <input message="Please your PGP password:" addproperty="pgp.password"/>
    </target>

	<!--
	This uses the commons-openpgp, which is a sandbox component for which there is no release.
	The compile copy was taken from: http://makumba.svn.sf.net/viewvc/makumba/trunk/makumba/lib/building/commons-openpgp-1.0-SNAPSHOT.jar?view=log
	Note that the BouncyCastle provider and PGP API needs to be installed on the JVM. See
	http://www.randombugs.com/java/javalangsecurityexception-jce-authenticate-provider-bc.html
	-->
	<target name="pgp:sign" xmlns:openpgp="antlib:org.apache.commons.openpgp.ant" depends = "pgp:password">
		<openpgp:signer
		        secring="${pgp.secring}"
		        pubring="${pgp.pubring}"
		        password="${pgp.password}"
		        keyid="${pgp.keyid}"
		        asciiarmor="true"
				artefact="../impala-build/build.xml">
		</openpgp:signer>
	</target>

</project>
