<?xml version="1.0"?>
<project name="Impala Web Build">

	<target 
		name="web:init">
		<delete dir="${war.staging.dir}" failonerror="false"/>
		<mkdir dir="${war.staging.dir}"/>
	</target>	
	
	<target 
		name="web:stage" 
		depends="web:init">
		
		<copy todir="${war.staging.dir}">
			<fileset dir="${war.context.dir}" 
				excludes=
				"**/*.java
				WEB-INF/lib/*"/>
		</copy>
	</target>	
	
	<target 
		name="web:libs" 
		depends="web:stage">
		
		<property name = "web.lib.includes" value = "**/*.jar"/>
		<property name = "web.lib.excludes" value = "dist/*,**/*-sources.jar"/>
		<property name = "web.dist.target" value = "WEB-INF/modules"/>
		<property name = "web.module.includes" value = "dist/*.jar"/>
		<property name = "web.module.excludes" value = "dist/*-sources.jar"/>
		
		<copy todir="${war.staging.dir}/WEB-INF/lib"
			flatten="true">
			<fileset dir="${repository.dir}" 
				includes="${web.lib.includes}"
				excludes="${web.lib.excludes}"/>
		</copy>
		
		<copy todir="${war.staging.dir}/${web.dist.target}"
			flatten="true">
			<fileset dir="${repository.dir}" 
				includes="${web.module.includes}"
				excludes="${web.module.excludes}"/>
		</copy>
		
		<copy todir="${war.staging.dir}/WEB-INF/classes"
			flatten="true" 
			overwrite="true">
			<fileset dir="${external.web.config.dir}"/>
		</copy>
	</target>
	
	<target 
		name="web:war" 
		depends="web:libs">
		
		<jar destfile="${war.output.file}">
			<zipfileset dir="${war.staging.dir}" includes="**/*"/>
		</jar>
	</target>	
	
</project>