<?xml version="1.0"?>
<project name="Workspace Management Build">

	<property name="workspace.root" location=".." />
	<property name="impala.home" location="${workspace.root}/impala" />

	<echo level="debug">Using impala home: ${impala.home}</echo>

	<import file="${impala.home}/properties-build.xml" />
	<import file="${impala.home}/classpath-build.xml" />
	<import file="${impala.home}/tasks-build.xml" />

	<target name="scaffold:input-main-project" unless="main.project.name">
		<input message="Please enter main project name, to be used for root module:" addproperty="main.project.name" />
	</target>

	<target name="scaffold:input-module-project" unless="module.project.name">
		<input message="Please enter name of first non-root module:" addproperty="module.project.name" />
	</target>

	<target name="scaffold:input-web-project" unless="web.project.name">
		<input message="Please enter name of web project module:" addproperty="web.project.name" />
	</target>

	<target name="scaffold:input-repository-project" unless="repository.project.name">
		<input message="Please enter name of repository project:" addproperty="repository.project.name" />
	</target>

	<target name="scaffold:input-workspace-root" unless="workspace.root.location.input">
		<input message="Please enter name of workspace root directory:" addproperty="workspace.root.location.input" />
	</target>
	
	<!--
	Scaffold steps for initial project creation:
	- run ant -f scaffold-build.xml scaffold:create
	- check IMPALA_HOME is set correctly
	- then to main project, and run ant fetch, ant get
	- open eclipse in workspace root
	- import all projects
	-->
	<target name="scaffold:create-confirm" depends="scaffold:input-workspace-root,
								scaffold:input-main-project,
								scaffold:input-module-project,
								scaffold:input-web-project,
								scaffold:input-repository-project">
		<property name="workspace.root.location" location="${workspace.root.location.input}" />

		<echo>Workspace root location: ${workspace.root.location}</echo>
		<echo>Main (root) project name: ${main.project.name}</echo>
		<echo>First non-root module project name: ${module.project.name}</echo>
		<echo>Repository project name: ${repository.project.name}</echo>
		<echo>Web project name: ${web.project.name}</echo>

		<!-- FIXME offer better mechanism for continuing-->
		<input message="Press return key to continue, or CTRL + C to quit ..." />
	</target>

	<target name="scaffold:create" depends="scaffold:create-confirm">
		<mkdir dir="${workspace.root.location}" />
		
		<copy todir="${workspace.root.location}/${main.project.name}" filtering="true">
			<fileset dir="${impala.home}/scaffold/main">
			</fileset>
			<filterset>
				<filter token="main.project.name" value="${main.project.name}" />
				<filter token="module.project.name" value="${module.project.name}" />
				<filter token="web.project.name" value="${web.project.name}" />
				<filter token="repository.project.name" value="${repository.project.name}" />
			</filterset>
		</copy>		
		<copy todir="${workspace.root.location}/${main.project.name}/src">
			<fileset dir="${impala.home}/scaffold/src">
				<include name = "interfaces/*"/>
			</fileset>
		</copy>
		<copy file = "${impala.home}/scaffold/spring/parent-context.xml" 
			tofile="${workspace.root.location}/${main.project.name}/spring/parent-context.xml"/>

		<copy todir="${workspace.root.location}/${module.project.name}" filtering="true">
			<fileset dir="${impala.home}/scaffold/module">
			</fileset>
			<filterset>
				<filter token="main.project.name" value="${main.project.name}" />
				<filter token="module.project.name" value="${module.project.name}" />
				<filter token="web.project.name" value="${web.project.name}" />
				<filter token="repository.project.name" value="${repository.project.name}" />
			</filterset>
		</copy>		
		<copy todir="${workspace.root.location}/${module.project.name}/src">
			<fileset dir="${impala.home}/scaffold/src">
				<include name = "classes/*"/>
			</fileset>
		</copy>
		<copy file = "${impala.home}/scaffold/spring/module-context.xml" 
			tofile="${workspace.root.location}/${module.project.name}/spring/${module.project.name}-context.xml"/>

		<copy todir="${workspace.root.location}/${web.project.name}" filtering="true">
			<fileset dir="${impala.home}/scaffold/web">
			</fileset>
			<filterset>
				<filter token="main.project.name" value="${main.project.name}" />
				<filter token="module.project.name" value="${module.project.name}" />
				<filter token="web.project.name" value="${web.project.name}" />
				<filter token="repository.project.name" value="${repository.project.name}" />
			</filterset>
		</copy>		
		<copy todir="${workspace.root.location}/${web.project.name}/src">
			<fileset dir="${impala.home}/scaffold/src">
				<include name = "web/*"/>
			</fileset>
		</copy>
		<copy file = "${impala.home}/scaffold/spring/web-context.xml" 
			tofile="${workspace.root.location}/${web.project.name}/spring/${web.project.name}-context.xml"/>

		<copy todir="${workspace.root.location}/${repository.project.name}" filtering="true">
			<fileset dir="${impala.home}/scaffold/repository">
			</fileset>
			<filterset>
				<filter token="main.project.name" value="${main.project.name}" />
				<filter token="module.project.name" value="${module.project.name}" />
				<filter token="web.project.name" value="${web.project.name}" />
				<filter token="repository.project.name" value="${repository.project.name}" />
			</filterset>
		</copy>
	</target>

</project>