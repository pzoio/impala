<?xml version="1.0"?>
<project name="Impala Execution Build">

	<property name = "workspace.root" location = ".."/>
	<property name = "impala.home" location = "${workspace.root}/impala"/>
	
	<echo level="debug">Using impala home: ${impala.home}</echo>
	
	<import file = "${impala.home}/properties-build.xml"/>
	<import file = "${impala.home}/classpath-build.xml"/>
	
	<target name="execution:set-location"
		unless = "impala.execution.file.path">
		<property name = "impala.execution.file.path" location = "${impala.home}/execution-interactive.properties"/>
		<echo>Setting 'impala.execution.file.path' to ${impala.execution.file.path}</echo>
	</target>	
	
	<target name="execution:run"
		depends = "execution:set-location">

		<java classname="org.impalaframework.testrun.InteractiveTestRunner" classpathref="interactive.classpath" fork="true" >
			<jvmarg value="${run.jvm.args}"/>
			<jvmarg value="-Dimpala.execution.file.path=${impala.execution.file.path}"/>
			<jvmarg value="-Dtests.directory=${test.bin.dir}"/>
		</java>
	</target>

	<target name="execution:jetty">
		<fail unless = "webapp.port" message = "Property 'webapp.port' has not been specified"/>
		<fail unless = "context.dir" message = "Property 'context.dir' has not been specified"/>
		<fail unless = "context.path" message = "Property 'context.path' has not been specified"/>

		<java classname="org.impalaframework.web.StartJetty" classpathref="interactive.classpath" fork="true" >
			<jvmarg line="${run.jvm.args}"/>
			<jvmarg value="-Dimpala.execution.file.path=${impala.execution.file.path}"/>
			<!-- FIXME can remove this when we jvmarg value="-Dimpala.root.projects=${root.project.list}"/-->
			<arg value="${webapp.port}"/>
			<arg value="${context.dir}"/>
			<arg value="${context.path}"/>
		</java>
	</target>	
	
</project>