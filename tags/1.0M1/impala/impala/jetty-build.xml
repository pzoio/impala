<?xml version="1.0"?>
<project name="Impala Jetty Build">
	
	<property file="${impala.home}/jetty-build.properties"/>
	<import file = "${impala.home}/tomcat-build.xml"/>
	
	<property name = "web.lib.excludes" value = "${jetty.web.lib.excludes}"/>
	
	<target 
		name="jetty:stage">
		<antcall target="web:libs">
			<!-- relative to webs-->
			<param name="web.modules.target" value="${web.staging.dir}/war/WEB-INF/modules"/>
		</antcall>
		
		<!-- copy slf4j files into WEB-INF lib -->
		<copy todir="${web.staging.dir}/war/WEB-INF/lib"
			flatten="true">
			<fileset dir="${repository.dir}" 
				includes="${jetty.webinf.libdir.includes}"
				excludes="${jetty.webinf.libdir.excludes}"/>
		</copy>
		
		<!-- remove commons logging && MX4J libraries - these need to be on main class path -->
		<delete>
			<fileset dir="${web.staging.dir}/war/WEB-INF/lib" includes="${jetty.webinf.libdir.removes}"/>
		</delete>
		
	</target>
	
	<target 
		name="jetty:copy"
		depends="jetty:stage">
		
		<!-- copy the jetty jars in -->
		<copy todir="${web.staging.dir}/jetty"
			flatten="true">
			<fileset dir="${repository.dir}" 
				includes="${jetty.classpath.dir.includes}"
				excludes="${jetty.classpath.dir.excludes}"/>
		</copy>
		
		<!-- copy the jetty launcher in -->
		<copy todir="${web.staging.dir}/jetty"
			flatten="true">
			<fileset dir="${repository.dir}" 
				includes="**/*startjetty*.jar"/>
		</copy>
		
		<copy todir="${web.staging.dir}"
			flatten="true">
			<fileset dir="${repository.dir}" 
				includes="**/launcher.jar"/>
		</copy>
		
		<copy todir="${web.staging.dir}/${startup.config.dir}">
			<fileset dir = "${external.web.config.dir}"/>
		</copy>
		
		<copy todir="${web.staging.dir}">
			<fileset dir = "${impala.home}/scripts" includes="*jetty*"/>
		</copy>
		
	</target>		
</project>